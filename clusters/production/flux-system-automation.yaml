apiVersion: image.toolkit.fluxcd.io/v1alpha2
kind: ImageUpdateAutomation
metadata:
    name: bite
    namespace: staging-bite
spec:
    interval: 1m0s
    sourceRef:
        kind: GitRepository
        name: flux-system
    git:
        checkout:
            ref:
                branch: main
        commit:
            author:
                email: fluxcdbot@users.noreply.github.com
                name: fluxcdbot
            messageTemplate: |
                Automated image update

                Automation name: {{ .AutomationObject }}

                Files:
                {{ range $filename, $_ := .Updated.Files -}}
                - {{ $filename }}
                {{ end -}}

                Objects:
                {{ range $resource, $_ := .Updated.Objects -}}
                - {{ $resource.Kind }} {{ $resource.Name }}
                {{ end -}}

                Images:
                {{ range .Updated.Images -}}
                - {{.}}
                {{ end -}}
        push:
            branch: main
    update:
        path: ./apps/staging
        strategy: Setters
